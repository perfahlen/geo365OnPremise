var HeatMapLayer=function(a,k,q){var c=a,j,e,h=[],i,f;var o={intensity:0.5,radius:1000,unit:"meters",colourgradient:{"0.00":"rgba(255,0,255,20)","0.25":"rgba(0,0,255,40)","0.50":"rgba(0,255,0,80)","0.75":"rgba(255,255,0,120)","1.00":"rgba(255,0,0,150)"},callback:null};function l(){var s=c.getRootElement();if(s.childNodes.length>=3&&s.childNodes[2].childNodes.length>=2){j=document.createElement("canvas");j.style.position="relative";var r=document.createElement("div");r.style.position="absolute";r.style.left="0px";r.style.top="0px";r.appendChild(j);s.childNodes[2].childNodes[1].appendChild(r);m(q);g(k);e=d(o.colourgradient);i=Microsoft.Maps.Events.addHandler(c,"viewchangestart",n);f=Microsoft.Maps.Events.addHandler(c,"viewchangeend",b);b();delete l}else{setTimeout(l,100)}}function n(){var r=j.getContext("2d");r.clearRect(0,0,j.width,j.height)}function d(t){var s=document.createElement("canvas").getContext("2d");var r=s.createLinearGradient(0,0,256,0);for(var u in t){r.addColorStop(u,t[u])}s.fillStyle=r;s.fillRect(0,0,256,1);return s.getImageData(0,0,256,1).data}function p(){var t=j.getContext("2d");var v=t.getImageData(0,0,j.width,j.height);var u=v.data;for(var w=0,r=u.length;w<r;){var s=u[w+3]*4;if(s!=0){u[w]=e[s];u[w+1]=e[s+1];u[w+2]=e[s+2]}w+=4}t.putImageData(v,0,0)}function m(r){for(attrname in r){o[attrname]=r[attrname]}}function g(r){h=r}function b(){j.height=c.getHeight();j.width=c.getWidth();j.style.top=-j.height/2+"px";j.style.left=-j.width/2+"px";if(o.unit=="pixels"){radiusInPixel=o.radius}else{radiusInPixel=o.radius/c.getMetersPerPixel()}var A=j.getContext("2d");var B=c.tryLocationToPixel(h,Microsoft.Maps.PixelReference.control);var z="rgba(0, 0, 0, "+o.intensity+")";var t=256*Math.pow(2,c.getZoom());for(var s=0,u=B.length;s<u;s++){var w=B[s].x;var v=B[s].y;if(w<0){w+=t*Math.ceil(Math.abs(w/t))}var r=A.createRadialGradient(w,v,0,w,v,radiusInPixel);r.addColorStop(0,z);r.addColorStop(1,"transparent");A.fillStyle=r;A.fillRect(w-radiusInPixel,v-radiusInPixel,2*radiusInPixel,2*radiusInPixel)}p();if(o.callback){o.callback()}}this.Show=function(){if(j){j.style.display=""}};this.Hide=function(){if(j){j.style.display="none"}};this.SetOptions=function(r){m(r)};this.SetPoints=function(r){n();g(r);b()};this.Remove=function(){j.parentNode.parentNode.removeChild(j.parentNode);if(i){Microsoft.Maps.Events.removeHandler(i)}if(f){Microsoft.Maps.Events.removeHandler(f)}h=null;e=null;j=null;o=null;i=null;f=null};l()};Microsoft.Maps.moduleLoaded("HeatMapModule");